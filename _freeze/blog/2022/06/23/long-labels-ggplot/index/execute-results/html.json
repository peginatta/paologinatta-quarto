{
  "hash": "00dc92f5ba4b12265589c8b717748d4f",
  "result": {
    "markdown": "---\ntitle: \"Quick and easy ways to deal with long labels in ggplot2\"\ndate: 2022-06-23\ndescription: \"Explore different manual and automatic ways to rotate, dodge, recode, break up, and otherwise deal with long axis labels with ggplot2\"\nimage: index_files/figure-html/plot-all-1.png\ncategories:\n  - r\n  - tidyverse\n  - ggplot\n  - data visualization\ndoi: 10.59350/x7xtj-3dh31\ncitation: true\n---\n\n\n\n\nIn [one of the assignments](https://datavizs22.classes.andrewheiss.com/assignment/04-exercise/) for my [data visualization class](https://datavizs22.classes.andrewheiss.com/), I have students visualize the number of [essential construction projects](https://www1.nyc.gov/assets/buildings/html/essential-active-construction.html) that were allowed to continue during New York City's initial COVID shelter-in-place order in March and April 2020. It's a good dataset to practice visualizing amounts and proportions and to practice with **dplyr**'s `group_by()` and `summarize()` and shows some interesting trends.\n\nThe data includes a column for `CATEGORY`, showing the type of construction project that was allowed. It poses an interesting (and common!) visualization challenge: some of the category names are really long, and if you plot `CATEGORY` on the x-axis, the labels overlap and become unreadable, like this: \n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(tidyverse)  # dplyr, ggplot2, and friends\nlibrary(scales)     # Functions to format things nicely\n\n# Load pandemic construction data\nessential_raw <- read_csv(\"https://datavizs22.classes.andrewheiss.com/projects/04-exercise/data/EssentialConstruction.csv\")\n\nessential_by_category <- essential_raw %>%\n  # Calculate the total number of projects within each category\n  group_by(CATEGORY) %>%\n  summarize(total = n()) %>%\n  # Sort by total\n  arrange(desc(total)) %>%\n  # Make the category column ordered\n  mutate(CATEGORY = fct_inorder(CATEGORY))\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(essential_by_category,\n       aes(x = CATEGORY, y = total)) +\n  geom_col() +\n  scale_y_continuous(labels = comma) +\n  labs(x = NULL, y = \"Total projects\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/plot-the-problem-1.png){fig-align='center' width=90%}\n:::\n:::\n\n\nEw. The middle categories here get all blended together into an unreadable mess.\n\nFortunately there are a bunch of different ways to fix this, each with their own advantages and disadvantages!\n\n\n## Option A: Make the plot wider\n\nOne quick and easy way to fix this is to change the dimensions of the plot so that there's more space along the x-axis. If you're using R Markdown or Quarto, you can modify the chunk options and specify `fig.width`:\n\n\n::: {.cell layout-align=\"center\"}\n\n````{.cell-code}\n```{{r plot-wider, fig.width=10, fig.height=4}}\nggplot(essential_by_category,\n       aes(x = CATEGORY, y = total)) +\n  geom_col() +\n  scale_y_continuous(labels = comma) +\n  labs(x = NULL, y = \"Total projects\")\n```\n````\n\n::: {.cell-output-display}\n![](index_files/figure-html/plot-wider-1.png){fig-align='center' width=90%}\n:::\n:::\n\n\nIf you're using `ggsave()`, you can specify the height and width there too:\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggsave(name_of_plot, width = 10, height = 4, units = \"in\")\n```\n:::\n\n\nThat works, but now the font is tiny, so we need to adjust it up with `theme_gray(base_size = 18)`:\n\n\n::: {.cell layout-align=\"center\"}\n\n````{.cell-code}\n```{{r plot-wider-bigger, fig.width=10, fig.height=4}}\nggplot(essential_by_category,\n       aes(x = CATEGORY, y = total)) +\n  geom_col() +\n  scale_y_continuous(labels = comma) +\n  labs(x = NULL, y = \"Total projects\") +\n  theme_gray(base_size = 18)\n```\n````\n\n::: {.cell-output-display}\n![](index_files/figure-html/plot-wider-bigger-1.png){fig-align='center' width=90%}\n:::\n:::\n\n\nNow the font is bigger, but the labels overlap again! We could make the figure wider again, but then we'd need to increase the font size again, and now we're in an endless loop.\n\n**Verdict: 2/10, easy to do, but more of a quick band-aid-style solution; not super recommended.**\n\n\n## Option B: Swap the x- and y-axes\n\nAnother quick and easy solution is to switch the x- and y-axes. If we put the categories on the y-axis, each label will be on its own line so the labels can't overlap with each other anymore:\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(essential_by_category,\n       aes(y = fct_rev(CATEGORY), x = total)) +\n  geom_col() +\n  scale_x_continuous(labels = comma) +\n  labs(y = NULL, x = \"Total projects\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/plot-swap-1.png){fig-align='center' width=90%}\n:::\n:::\n\n\nThat works really well! However, it forces you to work with horizontal bars. If that doesn't fit with your overall design (e.g., if you really want vertical bars), this won't work. Additionally, if you have any really long labels, it can substantially shrink the plot area, like this:\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# Make one of the labels super long for fun\nessential_by_category %>%\n  mutate(CATEGORY = recode(CATEGORY, \"Schools\" = \"Preschools, elementary schools, middle schools, high schools, and other schools\")) %>%\n  ggplot(aes(y = fct_rev(CATEGORY), x = total)) +\n  geom_col() +\n  scale_x_continuous(labels = comma) +\n  labs(y = NULL, x = \"Total projects\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/plot-swap-long-1.png){fig-align='center' width=90%}\n:::\n:::\n\n\n**Verdict: 6/10, easy to do and works well if you're happy with horizontal bars; can break if labels are too long (though long y-axis labels are fixable with the other techniques in this post too).**\n\n\n## Option C: Recode some longer labels\n\nInstead of messing with the width of the plot, we can mess with the category names themselves. We can use `recode()` from **dplyr** to recode some of the longer category names or add line breaks (`\\n`) to them:\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nessential_by_category_shorter <- essential_by_category %>%\n  mutate(CATEGORY = recode(CATEGORY, \n                           \"Affordable Housing\" = \"Aff. Hous.\",\n                           \"Hospital / Health Care\" = \"Hosp./Health\",\n                           \"Public Housing\" = \"Pub. Hous.\",\n                           \"Homeless Shelter\" = \"Homeless\\nShelter\"))\n\nggplot(essential_by_category_shorter,\n       aes(x = CATEGORY, y = total)) +\n  geom_col() +\n  scale_y_continuous(labels = comma) +\n  labs(x = NULL, y = \"Total projects\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/plot-manual-1.png){fig-align='center' width=90%}\n:::\n:::\n\n\nThat works great! However, it reduces readibility (does \"Aff. Hous.\" mean affordable housing? affluent housing? affable housing?). It also requires more manual work and a lot of extra typing. If a new longer category gets added in a later iteration of the data, this code won't automatically shorten it.\n\n**Verdict: 6/10, we have more control over the labels, but too much abbreviation reduces readibility, and it's not automatic.**\n\n\n## Option D: Rotate the labels\n\nSince we want to avoid manually recoding categories, we can do some visual tricks to make the labels readable without changing any of the lable text. First we can rotate the labels a little. Here we rotate the labels 30°, but we could also do 45°, 90°, or whatever we want. If we add `hjust = 0.5` (horizontal justification), the rotated labels will be centered in the columns, and `vjust` (vertical justification) will center the labels vertically.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(essential_by_category,\n       aes(x = CATEGORY, y = total)) +\n  geom_col() +\n  scale_y_continuous(labels = comma) +\n  labs(x = NULL, y = \"Total projects\") +\n  theme(axis.text.x = element_text(angle = 30, hjust = 0.5, vjust = 0.5))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/plot-rotate-1.png){fig-align='center' width=90%}\n:::\n:::\n\n\nEverything fits great now, but I'm not a big fan of angled text. I'm also not happy with the all the empty vertical space between the axis and the shorter labels like \"Schools\" and \"Utility\". It would look a lot nicer to have all these labels right-aligned to the axis, but there's no way easy to do that.\n\n**Verdict: 5.5/10, no manual work needed, but angled text is harder to read and there's lots of extra uneven whitespace.**\n\n\n## Option E: Dodge the labels\n\nSecond, instead of rotating, as of [**ggplot2** v3.3.0](https://www.tidyverse.org/blog/2020/03/ggplot2-3-3-0/) we can automatically dodge the labels and make them offset across multiple rows with the `guide_axis(n.dodge = N)` function in `scale_x_*()`:\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(essential_by_category,\n       aes(x = CATEGORY, y = total)) +\n  geom_col() +\n  scale_x_discrete(guide = guide_axis(n.dodge = 2)) +\n  scale_y_continuous(labels = comma) +\n  labs(x = NULL, y = \"Total projects\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/plot-dodge-1.png){fig-align='center' width=90%}\n:::\n:::\n\n\nThat's pretty neat. Again, this is all automatic and we don't have to manually adjust any labels. The text is all horizontal so it's more readable. But I'm not a huge fan of the gaps above the second-row labels. Maybe it would look better if the corresponding axis ticks were a little longer, idk.\n\n**Verdict: 7/10, no manual work needed, labels easy to read, but there's extra whitespace that can sometimes feel unbalanced.**\n\n\n## Option F: Automatically add line breaks\n\nThe easiest and quickest and nicest way to fix these long labels, though, is to use the `label_wrap()` function from the **scales** package. This will automatically add line breaks after X characters in labels with lots of text—you just have to tell it how many characters to use. The function is smart enough to try to break after word boundaries—that is, if you tell it to break after 5 characters, it won't split something like \"Approved\" into \"Appro\" and \"ved\"; it'll break after the end of the word.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(essential_by_category,\n       aes(x = CATEGORY, y = total)) +\n  geom_col() +\n  scale_x_discrete(labels = label_wrap(10)) +\n  scale_y_continuous(labels = comma) +\n  labs(x = NULL, y = \"Total projects\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/plot-auto-1.png){fig-align='center' width=90%}\n:::\n:::\n\n\nLook at how the x-axis labels automatically break across lines! That's so neat!\n\n**Verdict: 11/10, no manual work needed, labels easy to read, everything's perfect. [This is the way.](https://www.starwars.com/news/this-is-the-way-the-mandalorian-art)**\n\nBonus: For things that aren't axis labels, like titles and subtitles, you can use `str_wrap()` from **stringr** to break long text at X characters (specified with `width`):\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(essential_by_category,\n       aes(x = CATEGORY, y = total)) +\n  geom_col() +\n  scale_x_discrete(labels = label_wrap(10)) +\n  scale_y_continuous(labels = comma) +\n  labs(x = NULL, y = \"Total projects\",\n       title = str_wrap(\n         \"Here's a really long title that will go off the edge of the figure unless it gets broken somewhere\", \n         width = 50),\n       subtitle = str_wrap(\n         \"Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.\",\n         width = 70))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/plot-auto-str-wrap-1.png){fig-align='center' width=90%}\n:::\n:::\n\n\n\n## Summary\n\nHere's a quick comparison of all these different approaches:\n\n\n::: {.cell .column-page-inset-right layout-align=\"center\"}\n::: {.cell-output-display}\n![](index_files/figure-html/plot-all-1.png){fig-align='center' width=100%}\n:::\n:::\n\n\n<hr>\n\n<details><summary>Session Info</summary>\n\n<div style='font-size:12px;'>\n\n::: {.cell layout-align=\"center\"}\n\n```\n## ─ Session info ───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────\n##  setting  value\n##  version  R version 4.3.0 (2023-04-21)\n##  os       macOS Ventura 13.4.1\n##  system   aarch64, darwin20\n##  ui       X11\n##  language (EN)\n##  collate  en_US.UTF-8\n##  ctype    en_US.UTF-8\n##  tz       America/New_York\n##  date     2023-08-25\n##  pandoc   2.19.2 @ /opt/homebrew/bin/ (via rmarkdown)\n##  quarto   1.3.433 @ /usr/local/bin/quarto\n## \n## ─ Packages ───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────\n##  ! package     * version date (UTC) lib source\n##  P dplyr       * 1.1.2   2023-04-20 [?] CRAN (R 4.3.0)\n##  P forcats     * 1.0.0   2023-01-29 [?] CRAN (R 4.3.0)\n##  P ggplot2     * 3.4.2   2023-04-03 [?] CRAN (R 4.3.0)\n##  P lubridate   * 1.9.2   2023-02-10 [?] CRAN (R 4.3.0)\n##  P patchwork   * 1.1.2   2022-08-19 [?] CRAN (R 4.3.0)\n##  P purrr       * 1.0.1   2023-01-10 [?] CRAN (R 4.3.0)\n##  P readr       * 2.1.4   2023-02-10 [?] CRAN (R 4.3.0)\n##  P scales      * 1.2.1   2022-08-20 [?] CRAN (R 4.3.0)\n##  P sessioninfo * 1.2.2   2021-12-06 [?] CRAN (R 4.3.0)\n##  P stringr     * 1.5.0   2022-12-02 [?] CRAN (R 4.3.0)\n##  P tibble      * 3.2.1   2023-03-20 [?] CRAN (R 4.3.0)\n##  P tidyr       * 1.3.0   2023-01-24 [?] CRAN (R 4.3.0)\n##  P tidyverse   * 2.0.0   2023-02-22 [?] CRAN (R 4.3.0)\n## \n##  [1] /Users/andrew/Sites/ath-quarto/renv/library/R-4.3/aarch64-apple-darwin20\n##  [2] /Users/andrew/Library/Caches/org.R-project.R/R/renv/sandbox/R-4.3/aarch64-apple-darwin20/84ba8b13\n## \n##  P ── Loaded and on-disk path mismatch.\n## \n## ──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────\n```\n:::\n\n</div>\n\n</details>\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}